{
  // Use IntelliSense to learn about possible attributes.
  // Hover to view descriptions of existing attributes.
  // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
  "version": "0.2.0",
  "configurations": [
    {
      "type": "node",
      "request": "launch",
      "name": "Launch Program",
      "skipFiles": ["<node_internals>/**"],
      "runtimeExecutable": "yarn",
      "runtimeArgs": ["start"],
      "outputCapture": "std",
      "program": "${workspaceFolder}/dist/index.js",
      "preLaunchTask": "${defaultBuildTask}",
      "outFiles": ["${workspaceFolder}/dist/**/*.js"]
    },
    {
      "type": "node",
      "request": "attach",
      "name": "Docker: Attach to service container",
      "smartStep": true,
      "localRoot": "${workspaceFolder}",
      "remoteRoot": "/usr/src/app",
      "resolveSourceMapLocations": null,
      "port": "${input:port}"
    },
    // Launch the service with inspector enabled using the repo's yarn start script
    {
      "type": "node",
      "request": "launch",
      "name": "Service: Launch with Inspector (yarn start)",
      "runtimeExecutable": "yarn",
      "args": ["start"],
      "env": {
        // yarn start reads INSPECT to add node inspector flags
        "INSPECT": "--inspect-brk=0.0.0.0:9229"
      },
      "cwd": "${workspaceFolder}",
      "console": "integratedTerminal",
      "sourceMaps": true,
      "outFiles": ["${workspaceFolder}/dist/**/*.js"],
      "resolveSourceMapLocations": [
        "${workspaceFolder}/**",
        "!**/node_modules/**"
      ],
      "skipFiles": ["<node_internals>/**"]
    },
    // Simple local attach to Node inspector on 9229
    {
      "type": "node",
      "request": "attach",
      "name": "Attach: Node 9229",
      "port": 9229,
      "restart": true,
      "sourceMaps": true,
      "outFiles": ["${workspaceFolder}/dist/**/*.js"],
      "resolveSourceMapLocations": [
        "${workspaceFolder}/**",
        "!**/node_modules/**"
      ],
      "skipFiles": ["<node_internals>/**"]
    },
    // Debug the updated-vs-created AVA test (no coverage, single process)
    {
      "type": "node",
      "request": "launch",
      "name": "AVA: updated-vs-created (no coverage)",
      "runtimeExecutable": "yarn",
      "args": [
        "ava",
        "-T", "60m",
        "--serial",
        "--no-worker-threads",
        "--node-arguments=--inspect-brk --enable-source-maps",
        "test/flIncidentsCsv.updated-vs-created.test.js"
      ],
      "cwd": "${workspaceFolder}",
      "console": "integratedTerminal",
      "sourceMaps": true,
      "outFiles": ["${workspaceFolder}/dist/**/*.js"],
      "resolveSourceMapLocations": [
        "${workspaceFolder}/**",
        "!**/node_modules/**"
      ],
      "skipFiles": ["<node_internals>/**"]
    }
  ],
  "inputs": [
    {
      "id": "port",
      "type": "promptString",
      "description": "Enter the port number of the inspector",
      "default": "9229"
    }
  ]
}
